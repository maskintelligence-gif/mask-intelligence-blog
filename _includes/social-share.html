{% comment %}
  Social Share Links Component
  Include with: {% include social-share.html %}
  
  Options:
  {% include social-share.html 
     title=page.title 
     url=page.url 
     summary=page.excerpt 
     via="maskintelligence" 
     hashtags="digital,intelligence,solutions"
  %}
{% endcomment %}

{% assign share_title = include.title | default: page.title | url_encode %}
{% assign share_url = include.url | default: page.url | absolute_url | url_encode %}
{% assign share_summary = include.summary | default: page.excerpt | strip_html | url_encode %}
{% assign via = include.via | default: "maskintelligence" %}
{% assign hashtags = include.hashtags | default: "digitalintelligence" %}

<div class="social-share" data-share-id="{{ page.id | default: 'share' }}">
  
  <div class="share-header">
    <h3 class="share-title">
      <i class="fas fa-share-alt"></i> Share This
    </h3>
    <p class="share-description">
      Help spread digital intelligence insights
    </p>
  </div>
  
  <div class="share-buttons">
    <!-- Twitter/X -->
    <a href="https://twitter.com/intent/tweet?text={{ share_title }}&url={{ share_url }}&via={{ via }}&hashtags={{ hashtags }}"
       class="share-btn share-twitter"
       target="_blank"
       rel="noopener noreferrer"
       title="Share on Twitter"
       onclick="window.open(this.href, 'twitter-share', 'width=550,height=235');return false;">
      <i class="fab fa-twitter"></i>
      <span class="share-btn-text">Twitter</span>
      <span class="share-count" data-service="twitter">0</span>
    </a>
    
    <!-- LinkedIn -->
    <a href="https://www.linkedin.com/shareArticle?mini=true&url={{ share_url }}&title={{ share_title }}&summary={{ share_summary }}&source=MaskIntelligence"
       class="share-btn share-linkedin"
       target="_blank"
       rel="noopener noreferrer"
       title="Share on LinkedIn"
       onclick="window.open(this.href, 'linkedin-share', 'width=550,height=435');return false;">
      <i class="fab fa-linkedin-in"></i>
      <span class="share-btn-text">LinkedIn</span>
      <span class="share-count" data-service="linkedin">0</span>
    </a>
    
    <!-- Facebook -->
    <a href="https://www.facebook.com/sharer/sharer.php?u={{ share_url }}"
       class="share-btn share-facebook"
       target="_blank"
       rel="noopener noreferrer"
       title="Share on Facebook"
       onclick="window.open(this.href, 'facebook-share', 'width=580,height=296');return false;">
      <i class="fab fa-facebook-f"></i>
      <span class="share-btn-text">Facebook</span>
      <span class="share-count" data-service="facebook">0</span>
    </a>
    
    <!-- WhatsApp -->
    <a href="https://wa.me/?text={{ share_title }}%20{{ share_url }}"
       class="share-btn share-whatsapp"
       target="_blank"
       rel="noopener noreferrer"
       title="Share on WhatsApp"
       onclick="window.open(this.href, 'whatsapp-share', 'width=550,height=435');return false;">
      <i class="fab fa-whatsapp"></i>
      <span class="share-btn-text">WhatsApp</span>
      <span class="share-count" data-service="whatsapp">-</span>
    </a>
    
    <!-- Email -->
    <a href="mailto:?subject={{ share_title }}&body=Check out this article from Mask Intelligence:%0A%0A{{ share_title }}%0A{{ share_url }}%0A%0A{{ share_summary }}"
       class="share-btn share-email"
       title="Share via Email">
      <i class="fas fa-envelope"></i>
      <span class="share-btn-text">Email</span>
      <span class="share-count" data-service="email">-</span>
    </a>
    
    <!-- Copy Link -->
    <button class="share-btn share-copy"
            title="Copy to clipboard"
            onclick="copyToClipboard('{{ share_url }}', this)">
      <i class="fas fa-link"></i>
      <span class="share-btn-text">Copy Link</span>
      <span class="share-copy-feedback">Copied!</span>
    </button>
  </div>
  
  <!-- Share stats (optional) -->
  <div class="share-stats">
    <div class="stats-item">
      <i class="fas fa-eye"></i>
      <span class="stats-label">Views:</span>
      <span class="stats-value" data-views="0">0</span>
    </div>
    <div class="stats-item">
      <i class="fas fa-share"></i>
      <span class="stats-label">Shares:</span>
      <span class="stats-value" data-shares="0">0</span>
    </div>
  </div>
  
</div>

<style>
.social-share {
  margin: 3rem 0;
  padding: 2rem;
  background: linear-gradient(145deg, var(--background-alt-color) 0%, #ffffff 100%);
  border-radius: 12px;
  border: 1px solid var(--border-color);
  box-shadow: 0 4px 16px rgba(0,0,0,0.05);
}

.share-header {
  text-align: center;
  margin-bottom: 2rem;
}

.share-title {
  margin: 0 0 0.5rem;
  color: var(--text-color);
  font-size: 1.4rem;
  display: flex;
  align-items: center;
  justify-content: center;
  gap: 10px;
}

.share-title i {
  color: var(--primary-color);
}

.share-description {
  margin: 0;
  color: var(--text-color-light);
  font-size: 0.95rem;
}

.share-buttons {
  display: grid;
  grid-template-columns: repeat(auto-fit, minmax(140px, 1fr));
  gap: 12px;
  margin: 2rem 0;
}

@media (max-width: 768px) {
  .share-buttons {
    grid-template-columns: repeat(2, 1fr);
  }
}

@media (max-width: 480px) {
  .share-buttons {
    grid-template-columns: 1fr;
  }
}

.share-btn {
  display: flex;
  align-items: center;
  justify-content: center;
  gap: 10px;
  padding: 12px 20px;
  border-radius: 8px;
  text-decoration: none;
  color: white;
  font-weight: 500;
  transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
  border: none;
  cursor: pointer;
  position: relative;
  overflow: hidden;
}

.share-btn:hover {
  transform: translateY(-3px);
  box-shadow: 0 6px 20px rgba(0,0,0,0.15);
}

.share-btn:active {
  transform: translateY(-1px);
}

.share-btn::after {
  content: '';
  position: absolute;
  top: 50%;
  left: 50%;
  width: 5px;
  height: 5px;
  background: rgba(255,255,255,0.5);
  opacity: 0;
  border-radius: 100%;
  transform: scale(1, 1) translate(-50%);
  transform-origin: 50% 50%;
}

.share-btn:focus:not(:active)::after {
  animation: ripple 1s ease-out;
}

@keyframes ripple {
  0% {
    transform: scale(0, 0);
    opacity: 0.5;
  }
  100% {
    transform: scale(20, 20);
    opacity: 0;
  }
}

.share-btn i {
  font-size: 1.2rem;
}

.share-btn-text {
  font-size: 0.95rem;
}

.share-count {
  margin-left: auto;
  background: rgba(255,255,255,0.2);
  padding: 2px 8px;
  border-radius: 12px;
  font-size: 0.8rem;
  min-width: 20px;
  text-align: center;
}

/* Button Colors */
.share-twitter { background: #1DA1F2; }
.share-linkedin { background: #0077B5; }
.share-facebook { background: #1877F2; }
.share-whatsapp { background: #25D366; }
.share-email { background: #EA4335; }
.share-copy { 
  background: var(--primary-color); 
  color: white;
}

.share-twitter:hover { background: #0d8bd9; }
.share-linkedin:hover { background: #006097; }
.share-facebook:hover { background: #0d65d9; }
.share-whatsapp:hover { background: #1da851; }
.share-email:hover { background: #d32f2f; }
.share-copy:hover { background: var(--primary-color-dark); }

/* Copy feedback */
.share-copy-feedback {
  position: absolute;
  top: -30px;
  left: 50%;
  transform: translateX(-50%);
  background: var(--success-color);
  color: white;
  padding: 5px 10px;
  border-radius: 4px;
  font-size: 0.8rem;
  opacity: 0;
  pointer-events: none;
  transition: opacity 0.3s;
}

.share-copy.copied .share-copy-feedback {
  opacity: 1;
  animation: fadeOut 2s forwards;
}

@keyframes fadeOut {
  0%, 70% { opacity: 1; }
  100% { opacity: 0; }
}

/* Share Stats */
.share-stats {
  display: flex;
  justify-content: center;
  gap: 30px;
  margin-top: 2rem;
  padding-top: 1.5rem;
  border-top: 1px solid var(--border-color);
}

.stats-item {
  display: flex;
  align-items: center;
  gap: 8px;
  color: var(--text-color-light);
  font-size: 0.9rem;
}

.stats-item i {
  color: var(--primary-color);
}

.stats-value {
  font-weight: bold;
  color: var(--text-color);
}

/* Dark mode adjustments */
@media (prefers-color-scheme: dark) {
  .social-share {
    background: linear-gradient(145deg, #1e293b 0%, #0f172a 100%);
    border-color: #334155;
  }
  
  .share-title {
    color: #f8fafc;
  }
  
  .share-description {
    color: #cbd5e1;
  }
  
  .share-stats {
    border-color: #334155;
  }
}
</style>

<script>
// Copy to clipboard function
function copyToClipboard(text, button) {
  navigator.clipboard.writeText(text).then(function() {
    // Show feedback
    button.classList.add('copied');
    setTimeout(() => {
      button.classList.remove('copied');
    }, 2000);
    
    // Optional: Track copy event
    trackShareEvent('copy');
  }).catch(function(err) {
    console.error('Failed to copy: ', err);
    // Fallback for older browsers
    const textArea = document.createElement('textarea');
    textArea.value = text;
    document.body.appendChild(textArea);
    textArea.select();
    try {
      document.execCommand('copy');
      button.classList.add('copied');
      setTimeout(() => {
        button.classList.remove('copied');
      }, 2000);
      trackShareEvent('copy');
    } catch (err) {
      console.error('Fallback copy failed: ', err);
    }
    document.body.removeChild(textArea);
  });
}

// Share tracking function (basic example)
function trackShareEvent(platform) {
  // Here you would normally send data to your analytics
  console.log(`Shared on ${platform}: ${window.location.href}`);
  
  // Update share count visually
  const shareElement = document.querySelector(`[data-service="${platform}"]`);
  if (shareElement && shareElement.textContent !== '-') {
    const currentCount = parseInt(shareElement.textContent) || 0;
    shareElement.textContent = currentCount + 1;
  }
  
  // Update total shares
  const totalShares = document.querySelector('[data-shares]');
  if (totalShares) {
    const currentShares = parseInt(totalShares.textContent) || 0;
    totalShares.textContent = currentShares + 1;
  }
}

// Attach tracking to share buttons
document.addEventListener('DOMContentLoaded', function() {
  const shareButtons = document.querySelectorAll('.share-btn:not(.share-copy)');
  
  shareButtons.forEach(button => {
    button.addEventListener('click', function() {
      const platform = this.classList[1].replace('share-', '');
      trackShareEvent(platform);
    });
  });
  
  // Simulate share counts (replace with real API call)
  setTimeout(() => {
    const counts = {
      twitter: Math.floor(Math.random() * 15),
      linkedin: Math.floor(Math.random() * 8),
      facebook: Math.floor(Math.random() * 12)
    };
    
    Object.entries(counts).forEach(([platform, count]) => {
      const element = document.querySelector(`[data-service="${platform}"]`);
      if (element) element.textContent = count;
    });
    
    // Update total shares
    const total = Object.values(counts).reduce((a, b) => a + b, 0);
    const totalElement = document.querySelector('[data-shares]');
    if (totalElement) totalElement.textContent = total;
    
    // Simulate views
    const viewsElement = document.querySelector('[data-views]');
    if (viewsElement) {
      const views = Math.floor(Math.random() * 100) + 50;
      viewsElement.textContent = views;
    }
  }, 1000);
});

// Page view tracking (basic)
if (typeof localStorage !== 'undefined') {
  const pageKey = `page_views_${window.location.pathname}`;
  let views = parseInt(localStorage.getItem(pageKey)) || 0;
  views++;
  localStorage.setItem(pageKey, views);
  
  // Update views display
  const viewsElement = document.querySelector('[data-views]');
  if (viewsElement) {
    viewsElement.textContent = views;
  }
}
</script>
