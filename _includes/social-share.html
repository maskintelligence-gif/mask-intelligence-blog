{% comment %}
  Enhanced Minimal Social Share
  Include with: {% include social-share.html %}
{% endcomment %}

{% assign share_title = page.title | url_encode %}
{% assign share_url = page.url | absolute_url | url_encode %}
{% assign share_summary = page.excerpt | default: page.description | strip_html | url_encode %}

<div class="social-share-minimal">
  <span class="share-label">Share This:</span>
  
  <div class="share-icons">
  
    
    <!-- LinkedIn -->
    <a href="https://www.linkedin.com/shareArticle?mini=true&url={{ share_url }}&title={{ share_title }}&summary={{ share_summary }}"
       class="share-icon linkedin"
       target="_blank"
       rel="noopener noreferrer"
       title="Share on LinkedIn"
       onclick="trackShare('linkedin')">
      <i class="fab fa-linkedin-in"></i>
    </a>
    
    <!-- Facebook -->
    <a href="https://www.facebook.com/sharer/sharer.php?u={{ share_url }}"
       class="share-icon facebook"
       target="_blank"
       rel="noopener noreferrer"
       title="Share on Facebook"
       onclick="trackShare('facebook')">
      <i class="fab fa-facebook-f"></i>
    </a>
    
  
    
    <!-- Email -->
    <a href="mailto:?subject={{ share_title }}&body=Check%20this%20out:%20{{ share_url }}"
       class="share-icon email"
       title="Share via Email"
       onclick="trackShare('email')">
      <i class="fas fa-envelope"></i>
    </a>
    
    <!-- Reddit -->
    <a href="https://reddit.com/submit?url={{ share_url }}&title={{ share_title }}"
       class="share-icon reddit"
       target="_blank"
       rel="noopener noreferrer"
       title="Share on Reddit"
       onclick="trackShare('reddit')">
      <i class="fab fa-reddit-alien"></i>
    </a>
    
    <!-- Telegram -->
    <a href="https://t.me/share/url?url={{ share_url }}&text={{ share_title }}"
       class="share-icon telegram"
       target="_blank"
       rel="noopener noreferrer"
       title="Share on Telegram"
       onclick="trackShare('telegram')">
      <i class="fab fa-telegram-plane"></i>
    </a>
    
    <!-- Pinterest (for visual content) -->
    <a href="https://pinterest.com/pin/create/button/?url={{ share_url }}&description={{ share_title }}&media={{ site.url }}{% if page.image %}{{ page.image }}{% else %}/assets/images/og-default.jpg{% endif %}"
       class="share-icon pinterest"
       target="_blank"
       rel="noopener noreferrer"
       title="Share on Pinterest"
       onclick="trackShare('pinterest')">
      <i class="fab fa-pinterest-p"></i>
    </a>
    
    <!-- Copy Link -->
    <button class="share-icon copy" 
            onclick="copyToClipboard('{{ share_url | absolute_url }}')" 
            title="Copy link to clipboard"
            data-copied="Copied!">
      <i class="fas fa-link"></i>
      <span class="copy-tooltip">Copy Link</span>
    </button>
  </div>
</div>

<style>
.social-share-minimal {
  display: flex;
  align-items: center;
  flex-wrap: wrap;
  gap: 15px;
  margin: 2.5rem 0;
  padding: 1.2rem;
  background: linear-gradient(145deg, var(--background-alt-color) 0%, #ffffff 100%);
  border-radius: 12px;
  border: 1px solid var(--border-color);
  box-shadow: 0 4px 12px rgba(0,0,0,0.05);
}

.share-label {
  font-weight: 600;
  color: var(--text-color);
  font-size: 1rem;
  white-space: nowrap;
}

.share-icons {
  display: flex;
  flex-wrap: wrap;
  gap: 8px;
  flex: 1;
  justify-content: flex-start;
}

.share-icon {
  display: inline-flex;
  align-items: center;
  justify-content: center;
  width: 40px;
  height: 40px;
  border-radius: 50%;
  color: white;
  text-decoration: none;
  transition: all 0.25s cubic-bezier(0.4, 0, 0.2, 1);
  position: relative;
  border: none;
  cursor: pointer;
  font-size: 1rem;
}

.share-icon:hover {
  transform: translateY(-3px) scale(1.1);
  box-shadow: 0 6px 15px rgba(0,0,0,0.15);
}

.share-icon:active {
  transform: translateY(-1px) scale(1.05);
}

/* Platform Colors */
.share-icon.twitter { background: #1DA1F2; }
.share-icon.linkedin { background: #0077B5; }
.share-icon.facebook { background: #1877F2; }
.share-icon.whatsapp { background: #25D366; }
.share-icon.email { background: #EA4335; }
.share-icon.reddit { background: #FF4500; }
.share-icon.telegram { background: #0088cc; }
.share-icon.pinterest { background: #E60023; }
.share-icon.copy { 
  background: var(--primary-color); 
  position: relative;
}

/* Hover Darken Effects */
.share-icon.twitter:hover { background: #0d8bd9; }
.share-icon.linkedin:hover { background: #006097; }
.share-icon.facebook:hover { background: #0d65d9; }
.share-icon.whatsapp:hover { background: #1da851; }
.share-icon.email:hover { background: #d32f2f; }
.share-icon.reddit:hover { background: #e03a00; }
.share-icon.telegram:hover { background: #0077b3; }
.share-icon.pinterest:hover { background: #cc001f; }
.share-icon.copy:hover { background: var(--primary-color-dark); }

/* Copy Tooltip */
.copy-tooltip {
  position: absolute;
  bottom: -30px;
  left: 50%;
  transform: translateX(-50%);
  background: var(--text-color);
  color: white;
  padding: 4px 10px;
  border-radius: 4px;
  font-size: 0.75rem;
  white-space: nowrap;
  opacity: 0;
  pointer-events: none;
  transition: opacity 0.3s;
  z-index: 100;
}

.copy-tooltip::before {
  content: '';
  position: absolute;
  top: -5px;
  left: 50%;
  transform: translateX(-50%);
  border-left: 5px solid transparent;
  border-right: 5px solid transparent;
  border-bottom: 5px solid var(--text-color);
}

.share-icon.copy:hover .copy-tooltip {
  opacity: 1;
}

/* Success feedback for copy */
.share-icon.copy.copied {
  background: var(--success-color);
  animation: pulse 0.5s;
}

@keyframes pulse {
  0% { transform: scale(1); }
  50% { transform: scale(1.1); }
  100% { transform: scale(1); }
}

/* Responsive Design */
@media (max-width: 768px) {
  .social-share-minimal {
    flex-direction: column;
    align-items: flex-start;
    gap: 12px;
  }
  
  .share-icons {
    justify-content: flex-start;
    width: 100%;
  }
  
  .share-icon {
    width: 38px;
    height: 38px;
    font-size: 0.95rem;
  }
}

@media (max-width: 480px) {
  .share-icons {
    gap: 6px;
  }
  
  .share-icon {
    width: 36px;
    height: 36px;
  }
}

/* Dark mode adjustments */
@media (prefers-color-scheme: dark) {
  .social-share-minimal {
    background: linear-gradient(145deg, #1e293b 0%, #0f172a 100%);
    border-color: #334155;
  }
  
  .share-label {
    color: #e2e8f0;
  }
  
  .copy-tooltip {
    background: #475569;
  }
  
  .copy-tooltip::before {
    border-bottom-color: #475569;
  }
}
</style>

<script>
// Copy to clipboard with better feedback
function copyToClipboard(text) {
  const button = event.currentTarget;
  
  navigator.clipboard.writeText(text).then(() => {
    // Visual feedback
    button.classList.add('copied');
    const originalHTML = button.innerHTML;
    
    // Temporarily change icon
    button.innerHTML = '<i class="fas fa-check"></i>';
    
    // Show success
    setTimeout(() => {
      button.classList.remove('copied');
      button.innerHTML = originalHTML;
    }, 1500);
    
    // Track copy
    trackShare('copy');
    
    // Optional: Show subtle notification
    showNotification('Link copied to clipboard!');
    
  }).catch(err => {
    console.error('Failed to copy: ', err);
    // Fallback for older browsers
    const textArea = document.createElement('textarea');
    textArea.value = text;
    document.body.appendChild(textArea);
    textArea.select();
    try {
      document.execCommand('copy');
      button.classList.add('copied');
      button.innerHTML = '<i class="fas fa-check"></i>';
      setTimeout(() => {
        button.classList.remove('copied');
        button.innerHTML = '<i class="fas fa-link"></i><span class="copy-tooltip">Copy Link</span>';
      }, 1500);
      trackShare('copy');
      showNotification('Link copied to clipboard!');
    } catch (err) {
      console.error('Fallback copy failed: ', err);
      showNotification('Failed to copy link', true);
    }
    document.body.removeChild(textArea);
  });
}

// Simple notification
function showNotification(message, isError = false) {
  // Remove existing notification
  const existing = document.querySelector('.share-notification');
  if (existing) existing.remove();
  
  // Create new notification
  const notification = document.createElement('div');
  notification.className = `share-notification ${isError ? 'error' : 'success'}`;
  notification.textContent = message;
  notification.style.cssText = `
    position: fixed;
    bottom: 20px;
    right: 20px;
    background: ${isError ? '#f87171' : '#10b981'};
    color: white;
    padding: 12px 20px;
    border-radius: 8px;
    box-shadow: 0 4px 12px rgba(0,0,0,0.15);
    z-index: 1000;
    animation: slideIn 0.3s ease;
    font-size: 0.9rem;
  `;
  
  document.body.appendChild(notification);
  
  // Auto remove after 3 seconds
  setTimeout(() => {
    notification.style.animation = 'slideOut 0.3s ease';
    setTimeout(() => notification.remove(), 300);
  }, 3000);
}

// Keyframe animations for notification
const style = document.createElement('style');
style.textContent = `
  @keyframes slideIn {
    from {
      transform: translateX(100%);
      opacity: 0;
    }
    to {
      transform: translateX(0);
      opacity: 1;
    }
  }
  
  @keyframes slideOut {
    from {
      transform: translateX(0);
      opacity: 1;
    }
    to {
      transform: translateX(100%);
      opacity: 0;
    }
  }
`;
document.head.appendChild(style);

// Track share events (for analytics)
function trackShare(platform) {
  // Here you would normally send to Google Analytics, etc.
  console.log(`Shared on ${platform}: ${window.location.href}`);
  
  // Example: Save to localStorage for simple tracking
  if (typeof localStorage !== 'undefined') {
    const shares = JSON.parse(localStorage.getItem('mask_shares') || '{}');
    shares[platform] = (shares[platform] || 0) + 1;
    localStorage.setItem('mask_shares', JSON.stringify(shares));
  }
}

// Initialize platform tracking on all share links
document.addEventListener('DOMContentLoaded', function() {
  const shareLinks = document.querySelectorAll('.share-icon[href]');
  
  shareLinks.forEach(link => {
    link.addEventListener('click', function(e) {
      // Only track if it's opening in a new window (not for mailto)
      if (!this.href.startsWith('mailto:')) {
        const platform = Array.from(this.classList)
          .find(cls => cls !== 'share-icon')
          .replace('share-', '');
        trackShare(platform);
      }
    });
  });
  
  // Pre-fetch share counts (optional - would need API)
  // fetchShareCounts();
});

// Optional: Fetch share counts from APIs
async function fetchShareCounts() {
  const url = encodeURIComponent(window.location.href);
  
  try {
    // Note: Most social APIs require server-side calls due to CORS
    // This is a placeholder for where you'd implement share counts
    console.log('Fetch share counts for:', url);
  } catch (error) {
    console.log('Share count fetch error:', error);
  }
}
</script>
